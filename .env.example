# Restaurant OS Environment Configuration
# Copy this file to .env and fill in your values
# Last Updated: 2025-10-05
#
# IMPORTANT: This is a MONOREPO setup with ONE .env file in the root
# - Server reads all variables
# - Client (Vite) reads ONLY variables with VITE_ prefix
# - Keep this file in ROOT directory - do NOT create client/.env.local

# ====================
# Server Configuration
# ====================
NODE_ENV=development
PORT=3001
DEFAULT_RESTAURANT_ID=11111111-1111-1111-1111-111111111111

# ====================
# Supabase Configuration
# ====================
# Get these from: https://app.supabase.com/project/YOUR_PROJECT
SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_KEY=your_supabase_service_role_key_here
SUPABASE_JWT_SECRET=your_jwt_secret_here # CRITICAL: Required for auth in v6.0.5+

# Database URL (Cloud Supabase)
# Get from: Supabase Dashboard > Settings > Database > Connection string
# Format: postgresql://postgres.[project-ref]:[password]@aws-0-us-east-1.pooler.supabase.com:5432/postgres
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# ====================
# OpenAI Configuration
# ====================
OPENAI_API_KEY=your_openai_api_key_here
# OPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2024-10-01

# Optional emergency fallback (leave unset in production)
# AI_DEGRADED_MODE=true

# ====================
# Square Payment Configuration
# ====================
# Get these from: https://developer.squareup.com/apps
SQUARE_ACCESS_TOKEN=your_square_access_token_here
SQUARE_LOCATION_ID=your_square_location_id_here
SQUARE_ENVIRONMENT=sandbox # 'sandbox' for testing, 'production' for live payments
SQUARE_WEBHOOK_SIGNATURE_KEY=your_webhook_signature_key_here
# IMPORTANT: For production, ensure SQUARE_ACCESS_TOKEN starts with 'EAAA' (production token)

# ====================
# Security Configuration
# ====================
# Required for v6.0.5+
PIN_PEPPER=generate-random-string-here # For PIN hashing
DEVICE_FINGERPRINT_SALT=generate-random-string-here # For device binding
FRONTEND_URL=http://localhost:5173 # Required for CORS

# Dual Authentication Pattern (v6.0.8+)
# Enable support for both Supabase sessions AND localStorage sessions
# Required for demo/PIN/station authentication alongside Supabase
AUTH_DUAL_AUTH_ENABLE=true

# Authentication Role Aliasing
# Accept deprecated 'kiosk_demo' role as 'customer' for backwards compatibility
# Set to 'false' to reject kiosk_demo tokens (after migration complete)
AUTH_ACCEPT_KIOSK_DEMO_ALIAS=true

# ====================
# Logging & Monitoring
# ====================
LOG_LEVEL=debug
LOG_FORMAT=json
# ALLOWED_ORIGINS=https://example.com,https://app.example.com # Optional additional CORS origins
# SENTRY_DSN=your_sentry_dsn_here # Optional error tracking

# ====================
# Performance Configuration
# ====================
CACHE_TTL_SECONDS=300
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# ====================================================================================
# Client Configuration (VITE_ prefix REQUIRED for browser access)
# ====================================================================================
# ⚠️  CRITICAL: All client-side variables MUST start with VITE_
# ⚠️  Vite only exposes VITE_ prefixed variables to the browser for security
# ⚠️  Variables without VITE_ prefix will NOT be accessible in the client app

# REQUIRED: Core Client Variables (app will fail without these)
VITE_API_BASE_URL=http://localhost:3001
VITE_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key_here
VITE_DEFAULT_RESTAURANT_ID=11111111-1111-1111-1111-111111111111
VITE_ENVIRONMENT=development

# Square frontend configuration
VITE_SQUARE_APP_ID=your_square_app_id
VITE_SQUARE_LOCATION_ID=your_square_location_id
VITE_SQUARE_ENVIRONMENT=sandbox # Must match SQUARE_ENVIRONMENT

# Optional client features
VITE_USE_MOCK_DATA=false
VITE_USE_REALTIME_VOICE=false
VITE_ENABLE_PERF=false # Performance monitoring
VITE_DEBUG_VOICE=false # Voice/menu debugging
VITE_DEMO_PANEL=0 # Enable demo auth panel (set to '1' for development)
VITE_OPENAI_API_KEY=your_openai_api_key_here # Required for client-side voice WebRTC
# VITE_OPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2024-10-01 # For voice features

# ====================
# Notes & Troubleshooting
# ====================
# 1. Never commit .env with actual values - only commit .env.example
# 2. All VITE_ prefixed variables are exposed to the browser
# 3. Variables WITHOUT VITE_ prefix are server-only (not accessible in client)
# 4. ONE .env file in ROOT - do NOT create client/.env.local or server/.env
# 5. Restart dev servers after changing .env file
# 6. For production deployment, see docs/DEPLOYMENT.md
#
# Common Issues:
# - "Blank login page" → Missing VITE_ prefixes, check client/src/config/env-validator.ts
# - "Missing Supabase vars" → Forgot to add VITE_ prefix
# - "Cannot find .env" → File must be in ROOT directory, not in client/ or server/