# ============================================
# RESTAURANT OS ENVIRONMENT VARIABLES
# Last Updated: 2025-11-15
# ============================================
# MONOREPO SETUP: ONE .env file in root directory
# - Server: Reads all variables
# - Client: Reads ONLY VITE_ prefixed variables
# - Production: Set via platform dashboards (Vercel/Render)
#
# SECURITY: Never commit real secrets - use placeholders only
# ============================================

# ====================
# Server Configuration
# ====================
NODE_ENV=production
PORT=3001
DEFAULT_RESTAURANT_ID=grow

# ====================
# Supabase Configuration
# ====================
# Get these from: https://app.supabase.com/project/YOUR_PROJECT
# NOTE: SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are also required for MCP server
SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_KEY=your_supabase_service_role_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here  # Same as SERVICE_KEY, required for MCP
SUPABASE_JWT_SECRET=your_jwt_secret_here # CRITICAL: Required for auth in v6.0.5+

# Database URL (Cloud Supabase)
# Get from: Supabase Dashboard > Settings > Database > Connection string
# Format: postgresql://postgres.[project-ref]:[password]@aws-0-us-east-1.pooler.supabase.com:5432/postgres
DATABASE_URL=postgresql://user:password@localhost:5432/dbname

# ====================
# OpenAI Configuration
# ====================
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2024-10-01

# Optional emergency fallback (leave unset in production)
# AI_DEGRADED_MODE=true

# ====================
# Stripe Payment Configuration
# ====================
# Get these from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_... # Server-side only, starts with sk_test_ or sk_live_
STRIPE_PUBLISHABLE_KEY=pk_test_... # Client-side, starts with pk_test_ or pk_live_
STRIPE_WEBHOOK_SECRET=whsec_... # From Stripe Dashboard > Webhooks
# IMPORTANT: For production, use live keys (sk_live_, pk_live_)

# ====================
# Authentication & Security [TIER 2: Production Required]
# ====================
# CRITICAL: Generate secure 32+ character hex strings for production
# Use: openssl rand -hex 32
KIOSK_JWT_SECRET=[GENERATE_32_CHAR_HEX] # JWT signing for kiosk sessions
PIN_PEPPER=[GENERATE_32_CHAR_HEX] # PIN hashing pepper (ADR-009)
DEVICE_FINGERPRINT_SALT=[GENERATE_32_CHAR_HEX] # Device binding salt
STATION_TOKEN_SECRET=[GENERATE_32_CHAR_HEX] # Station authentication
WEBHOOK_SECRET=[GENERATE_32_CHAR_HEX] # Webhook signature verification

# Authentication behavior (optional, defaults work for most deployments)
STRICT_AUTH=false # Set 'true' in production for strict multi-tenant security (requires restaurant_id in JWT)
AUTH_ACCEPT_KIOSK_DEMO_ALIAS=true # Set 'false' to reject deprecated 'kiosk_demo' role alias

# Postmark email service (optional, for transactional emails)
POSTMARK_SERVER_TOKEN=your_postmark_server_token_here
POSTMARK_FROM_EMAIL=your-email@yourdomain.com

# CORS Configuration
FRONTEND_URL=https://july25-client.vercel.app
ALLOWED_ORIGINS=https://july25-client.vercel.app

# ====================
# Logging & Monitoring
# ====================
LOG_LEVEL=debug
LOG_FORMAT=json
# ALLOWED_ORIGINS=https://example.com,https://app.example.com # Optional additional CORS origins

# Sentry Error Tracking (Optional)
SENTRY_DSN=your_sentry_dsn_here
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# ====================
# Performance Configuration
# ====================
CACHE_TTL_SECONDS=300
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# ====================================================================================
# Client Configuration (VITE_ prefix REQUIRED for browser access)
# ====================================================================================
# ⚠️  CRITICAL: All client-side variables MUST start with VITE_
# ⚠️  Vite only exposes VITE_ prefixed variables to the browser for security
# ⚠️  Variables without VITE_ prefix will NOT be accessible in the client app

# REQUIRED: Core Client Variables (app will fail without these)
VITE_API_BASE_URL=https://july25.onrender.com
VITE_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key_here
VITE_DEFAULT_RESTAURANT_ID=grow
VITE_ENVIRONMENT=production

# Stripe frontend configuration
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_... # Same as STRIPE_PUBLISHABLE_KEY above

# Optional client features
VITE_USE_MOCK_DATA=false
VITE_USE_REALTIME_VOICE=false
VITE_ENABLE_PERF=false # Performance monitoring
VITE_DEBUG_VOICE=false # Voice/menu debugging
VITE_OPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2025-06-03 # Model for voice ordering

# SECURITY: Demo panel exposes demo credentials (server/kitchen/expo/admin)
# CRITICAL: MUST be '0' in production to prevent credential exposure
# Development: Set to '1' to enable quick-login demo panel
VITE_DEMO_PANEL=0

# ====================
# REMOVED: VITE_OPENAI_API_KEY
# ====================
# ⚠️  SECURITY: Client-side OpenAI API key removed in v6.0.14
# Voice ordering now uses server-side proxy to protect API keys
# OpenAI API calls are made from the backend only (see OPENAI_API_KEY above)
#
# DEPRECATED (for backward compatibility only, will be removed):
# VITE_OPENAI_API_KEY=removed_for_security

# ====================
# Notes & Troubleshooting
# ====================
# 1. Never commit .env with actual values - only commit .env.example
# 2. All VITE_ prefixed variables are exposed to the browser
# 3. Variables WITHOUT VITE_ prefix are server-only (not accessible in client)
# 4. ONE .env file in ROOT - do NOT create client/.env.local or server/.env
# 5. Restart dev servers after changing .env file
# 6. For production deployment, see docs/DEPLOYMENT.md
#
# Common Issues:
# - "Blank login page" → Missing VITE_ prefixes, check client/src/config/env-validator.ts
# - "Missing Supabase vars" → Forgot to add VITE_ prefix
# - "Cannot find .env" → File must be in ROOT directory, not in client/ or server/