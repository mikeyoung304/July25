# Documentation Orphan Prevention Strategy

**Document Version**: 1.0
**Created**: 2025-12-24
**Last Updated**: 2025-12-24
**Owner**: DevOps & Documentation Team

---

## Executive Summary

Documentation orphan accumulation stems from three core issues:

1. **Generated files mixed with tracked files** - `playwright-report/data/` files being committed as orphans
2. **Old reports without archival discipline** - `reports/` accumulating undated, unpurposed files
3. **Weak enforcement** - Pre-commit warnings that don't block, no automated cleanup, no retention policies

This strategy provides concrete prevention mechanisms across three layers: **automation**, **architecture**, and **discipline**.

---

## Problem Analysis

### Current State (As of 2025-12-24)

```
Orphans Currently Being Tracked:
├── playwright-report/data/        → 256 files (generated, should be ignored)
├── reports/e2e/voice/             → Multiple console logs, traces, videos
├── reports/*.md (undated)          → INDEX_*, REMAINING_WORK_*, TASK_BREAKDOWN_*
├── .claude/                        → 150+ documentation files (mixed quality)
└── todos/.archive/                 → 150+ archived todos (needs periodic cleanup)

Problems:
- playwright-report/data/ in .gitignore but still committed
- reports/ has no naming convention or retention policy
- .claude/ mixing temporary notes with permanent prevention strategies
- No automated cleanup triggers
- Pre-commit hook warns but doesn't block
```

### Root Causes

| Issue | Cause | Impact |
|-------|-------|--------|
| Generated files committed | .gitignore rule not working | Repository bloat |
| Old reports accumulate | No retention policy | Hard to find current data |
| Duplicate archival | Multiple archive structures | Confused governance |
| Weak enforcement | Warning-only pre-commit | Files slip through |
| Missing automation | No cleanup scripts | Manual burden |

---

## Prevention Strategy: Three Layers

### Layer 1: Automation (Fixes the Symptom)

#### 1A. .gitignore Hardening

**Fix generated file pollution:**

```bash
# In .gitignore

# Playwright Report Data (generated by playwright)
playwright-report/data/
playwright-report/*.json
playwright-report/*.html

# Reports (lifecycle-managed directories)
reports/e2e/*/video_*.webm
reports/e2e/*/trace.zip
reports/e2e/*/*.ndjson
reports/e2e/*/*.png
reports/artifacts/

# Temporary analysis outputs (cleaned up weekly)
reports/*_2025-*.md    # Undated analysis files
reports/*_20[0-9][0-9]-*.md
reports/*_METRICS_*.md
reports/*_BREAKDOWN_*.md

# Keep only these report types (dated, purposeful)
!reports/ARCHIVE_MANIFEST.md
!reports/README.md
!reports/scans/

# Claude documentation (temporary workings)
.claude/cache/
.claude/*.ndjson
.claude/*.log
```

**Validation:**
```bash
# Verify rules
git check-ignore -v playwright-report/data/*
git check-ignore -v reports/e2e/voice/*.png
git check-ignore -v reports/REMAINING_WORK*.md
```

#### 1B. Pre-Commit Hook Enforcement

**Upgrade from warning to blocking:**

```bash
# scripts/pre-commit-orphan-guard.sh

#!/bin/bash
set -e

RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m'

# Check 1: No generated files in stage area
INVALID_PATTERNS=(
    "playwright-report/data/"
    "reports/e2e/.*/(video_|trace|.*\.ndjson)"
    "reports/artifacts/"
    "reports/.*_2025-.*\.md"
)

echo "Checking for orphan files..."

FOUND_ORPHANS=0
for pattern in "${INVALID_PATTERNS[@]}"; do
    if git diff --cached --name-only | grep -E "$pattern" > /dev/null; then
        echo -e "${RED}✗ Error: Found commits matching pattern: $pattern${NC}"
        git diff --cached --name-only | grep -E "$pattern" | while read file; do
            echo -e "${RED}  - $file${NC}"
        done
        FOUND_ORPHANS=1
    fi
done

# Check 2: No root-level reports without date
ROOT_REPORTS=$(git diff --cached --name-only | grep '^reports/.*\.md$' | grep -v '_[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]')
if [ -n "$ROOT_REPORTS" ]; then
    echo -e "${RED}✗ Error: Reports must include date in filename (YYYY-MM-DD)${NC}"
    echo "$ROOT_REPORTS" | while read file; do
        echo -e "${RED}  - $file (missing date)${NC}"
    done
    FOUND_ORPHANS=1
fi

# Check 3: No .md files with "TODO", "DRAFT", "TEMP" without date
PROBLEMATIC=$(git diff --cached --name-only | grep -E '\.(md|txt)$' | while read f; do
    if head -n 20 "$f" 2>/dev/null | grep -qi "TODO\|DRAFT\|TEMP\|WIP"; then
        if ! echo "$f" | grep -qE '[0-9]{4}-[0-9]{2}-[0-9]{2}'; then
            echo "$f"
        fi
    fi
done)

if [ -n "$PROBLEMATIC" ]; then
    echo -e "${YELLOW}⚠ Warning: Documentation marked TODO/DRAFT/TEMP without date:${NC}"
    echo "$PROBLEMATIC" | while read file; do
        echo -e "${YELLOW}  - $file${NC}"
    done
fi

if [ $FOUND_ORPHANS -eq 1 ]; then
    echo -e "${RED}Commit blocked due to orphan file violations${NC}"
    exit 1
fi

echo -e "${GREEN}✓ Orphan check passed${NC}"
exit 0
```

**Installation:**
```bash
cp scripts/pre-commit-orphan-guard.sh .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

#### 1C. Automated Cleanup Jobs

**Weekly orphan cleanup (runs Friday 2 AM UTC):**

```yaml
# .github/workflows/orphan-cleanup.yml

name: Weekly Orphan Cleanup

on:
  schedule:
    - cron: '0 2 * * FRI'  # Fridays 2 AM UTC
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Remove stale report files
        run: |
          # Remove reports older than 60 days (except archived)
          find reports -maxdepth 1 -type f -name "*.md" -mtime +60 ! -path "*/archive/*" -delete

          # Remove e2e video artifacts older than 7 days
          find reports/e2e -type f \( -name "*.png" -o -name "*.webm" -o -name "*.zip" \) -mtime +7 -delete

          # Remove build artifacts older than 14 days
          find reports/artifacts -type f -mtime +14 -delete

      - name: Cleanup .claude cache
        run: |
          rm -rf .claude/cache/*.ndjson
          find .claude -name "*.log" -mtime +30 -delete

      - name: Generate cleanup report
        if: always()
        run: |
          cat > cleanup-report.txt << 'EOF'
          # Weekly Orphan Cleanup Report
          Date: $(date -u '+%Y-%m-%d %H:%M:%S UTC')

          ## Actions Taken
          - Removed reports older than 60 days
          - Removed e2e artifacts older than 7 days
          - Cleared .claude cache

          ## Current State
          EOF

          echo "### Reports Directory Size" >> cleanup-report.txt
          du -sh reports/ >> cleanup-report.txt

          echo "" >> cleanup-report.txt
          echo "### Sample Contents" >> cleanup-report.txt
          find reports -maxdepth 2 -type f | head -20 >> cleanup-report.txt

      - name: Create issue if cleanup needed
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('cleanup-report.txt', 'utf8');

            if (report.includes('Removed')) {
              github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: '[Maintenance] Weekly Orphan Cleanup Completed',
                body: report,
                labels: ['maintenance', 'documentation']
              });
            }

      - name: Commit cleanup
        if: always()
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore: cleanup orphaned and stale documentation files'
          file_pattern: 'reports/ .claude/cache/'
```

#### 1D. Report Retention Script

**Monthly consolidation and archival:**

```bash
# scripts/manage-report-lifecycle.sh
#!/bin/bash

set -e

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

ARCHIVE_BASE="reports/archive/$(date +%Y-%m)"

mkdir -p "$ARCHIVE_BASE"

echo -e "${BLUE}=== Report Lifecycle Management ===${NC}\n"

# 1. Archive old e2e reports (> 30 days)
echo -e "${BLUE}Step 1: Archiving old e2e reports${NC}"
find reports/e2e -maxdepth 2 -type f -mtime +30 | while read file; do
    mkdir -p "$ARCHIVE_BASE/e2e/$(dirname "$file" | cut -d/ -f3-)"
    mv "$file" "$ARCHIVE_BASE/e2e/$(dirname "$file" | cut -d/ -f3-)/"
    echo -e "${GREEN}  ✓ Archived: $file${NC}"
done

# 2. Consolidate reports with creation date
echo -e "\n${BLUE}Step 2: Dating undated reports${NC}"
find reports -maxdepth 1 -name "*.md" -type f ! -name "README.md" ! -name "ARCHIVE_MANIFEST.md" | while read file; do
    # Check if already dated
    if ! echo "$file" | grep -qE '[0-9]{4}-[0-9]{2}-[0-9]{2}'; then
        # Get creation date
        DATE=$(stat -f "%SB" -t "%Y-%m-%d" "$file" 2>/dev/null || date -r "$file" +%Y-%m-%d)
        DIRNAME=$(dirname "$file")
        BASENAME=$(basename "$file")
        NEW_NAME="$DIRNAME/${BASENAME%.md}-$DATE.md"

        if [ "$file" != "$NEW_NAME" ]; then
            mv "$file" "$NEW_NAME"
            echo -e "${GREEN}  ✓ Renamed: $BASENAME → ${BASENAME%.md}-$DATE.md${NC}"
        fi
    fi
done

# 3. Create manifest of archived items
echo -e "\n${BLUE}Step 3: Creating archive manifest${NC}"
{
    echo "# Report Archive - $(date +%Y-%m)"
    echo ""
    echo "Archived: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
    echo ""
    echo "## Contents"
    echo ""
    find "$ARCHIVE_BASE" -type f -name "*.md" -o -name "*.json" | sort | while read file; do
        REL_PATH=${file#$ARCHIVE_BASE/}
        echo "- [$REL_PATH](./$REL_PATH)"
    done
    echo ""
    echo "**Retention**: Archived reports kept for 12 months"
} > "$ARCHIVE_BASE/README.md"

echo -e "${GREEN}✓ Manifest created${NC}"

# 4. Summary
echo -e "\n${BLUE}=== Summary ===${NC}"
echo "Archive location: $ARCHIVE_BASE"
echo "Files archived: $(find "$ARCHIVE_BASE" -type f | wc -l)"
echo "Reports remaining in root: $(find reports -maxdepth 1 -name "*.md" -type f | wc -l)"
```

---

### Layer 2: Architecture (Fixes the Structure)

#### 2A. Reports Directory Reorganization

**Current problematic structure:**

```
reports/
├── *.md                          ← Undated, mixed purpose
├── *.txt                         ← Baselines (never updated)
├── *.sql, *.json                 ← Orphaned analysis
├── e2e/voice/
│   ├── *.ndjson                  ← Generated logs
│   ├── *.webm                    ← Videos
│   └── *.zip, *.png              ← Traces and screenshots
└── scans/                        ← Agent reports (not indexed)
```

**Recommended structure:**

```
reports/
├── README.md                     ← Entry point
├── MANIFEST.md                   ← Index of active reports
│
├── active/                       ← Living reports (< 30 days, regularly updated)
│   ├── coverage/
│   │   └── latest.json
│   ├── performance/
│   │   └── baseline-2025-Q4.json
│   └── health/
│       └── system-status-latest.json
│
├── snapshots/                    ← Point-in-time reports (30-day retention)
│   ├── 2025-12-24/
│   │   ├── test-results.json
│   │   └── build-analysis.html
│   └── 2025-12-17/
│       └── ...
│
├── e2e/                          ← E2E test artifacts
│   └── voice/
│       └── 2025-12-24-run1/      ← Timestamped runs only
│           ├── results.json
│           ├── videos/
│           └── traces/
│
├── archive/                      ← Historical (12-month retention)
│   └── 2025-Q4/
│       ├── post-mortems/
│       ├── audits/
│       └── incidents/
│
└── .gitignore                    ← CRITICAL: Ignore generated files
```

**Updated .gitignore for reports:**

```gitignore
# reports/ directory - Lifecycle management
reports/snapshots/**/          # Generated point-in-time reports
reports/e2e/*/videos/          # Video artifacts
reports/e2e/*/traces/          # Playwright traces
reports/artifacts/             # Build artifacts

# Keep only README and manifests at root
!reports/README.md
!reports/MANIFEST.md
!reports/ARCHIVE_MANIFEST.md

# Keep organized active/ and archive/ structures
!reports/active/
!reports/archive/

# Keep dated snapshot directories
!reports/snapshots/202[0-9]-*/
reports/snapshots/202[0-9]-*/**
!reports/snapshots/202[0-9]-*/*.md
!reports/snapshots/202[0-9]-*/README.md
```

#### 2B. File Naming Convention

**Enforce structured naming:**

```
PREFIX-YYYY-MM-DD[-CONTEXT][-VERSION].EXTENSION

Examples:
coverage-2025-12-24.json                    ✓ Dated
report-2025-12-24-performance-v1.html       ✓ Dated, version
baseline-tsc-2025-Q4.txt                    ✓ Dated (quarter)
REMAINING_WORK-2025-12-24.md                ✗ Was old, now should be temporary
scans-2025-12-24-agent-results-v2.md        ✓ Dated, agent-specific

Rules:
1. ALL reports must have date (YYYY-MM-DD or YYYY-QN)
2. Version suffix for sequential updates (v1, v2, ...)
3. Context suffix for environment/agent (optional but recommended)
4. UPPERCASE for permanent, lowercase for temporary
5. Use dashes, not underscores (easier to parse)
```

**Validation script:**

```bash
# scripts/validate-report-naming.sh
#!/bin/bash

echo "Validating report file naming..."

PATTERN="^[a-z]+-202[0-9]-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])"
QUARTER_PATTERN="^[a-z]+-202[0-9]-Q[1-4]"

VIOLATIONS=0
find reports -maxdepth 1 \( -name "*.md" -o -name "*.json" -o -name "*.txt" \) ! -name "README.md" ! -name "MANIFEST.md" | while read file; do
    BASENAME=$(basename "$file")

    if ! echo "$BASENAME" | grep -qE "$PATTERN|$QUARTER_PATTERN"; then
        echo "✗ VIOLATION: $BASENAME"
        echo "  Should match: prefix-YYYY-MM-DD[-context][-vN].ext"
        VIOLATIONS=$((VIOLATIONS + 1))
    fi
done

if [ $VIOLATIONS -gt 0 ]; then
    echo "Found $VIOLATIONS naming violations"
    exit 1
fi

echo "✓ All reports follow naming convention"
exit 0
```

#### 2C. .claude Directory Segregation

**Separate permanent from temporary:**

```
.claude/
├── README.md                    ← Navigation/index
│
├── prevention/                  ← PERMANENT: Prevention strategies
│   ├── DOCUMENTATION-ORPHAN-PREVENTION.md
│   ├── README.md
│   └── *.md                     ← All versioned, dated
│
├── lessons/                     ← PERMANENT: Lessons learned
│   ├── CL-AUTH-001-*.md         ← Incident-based
│   ├── CL-TEST-001-*.md
│   └── README.md
│
├── session-reports/             ← SEMI-PERMANENT: Session summaries
│   ├── 2025-12-24-code-review.md
│   └── README.md
│
├── cache/                       ← TEMPORARY: .gitignored
│   ├── *.json
│   ├── *.ndjson
│   └── .gitignore (content: *)
│
├── workings/                    ← TEMPORARY: Active drafts
│   ├── investigation-notes.md   ← Never committed
│   └── .gitignore (content: *)
│
└── commands/                    ← PERMANENT: Custom slash commands
    ├── maintain.md
    └── *.md
```

**.claude/.gitignore:**

```gitignore
# Temporary working files
workings/
workings/**

# Cache and generated files
cache/
cache/**
*.ndjson
*.log

# Lock files and temp configs
settings.local.json
*.local.json
~/.claude.backup*
```

#### 2D. Playwright Report Isolation

**Prevent data/ subdirectory pollution:**

```bash
# playwright.config.ts (or playwright.config.js)

export default defineConfig({
  outputDir: 'playwright-report-data',  // Explicit, isolated directory

  reporter: [
    ['json', { outputFile: 'playwright-report-latest.json' }],
    ['html', { open: 'never' }],
    ['github'],
  ],

  webServer: {
    // ... existing config
  },
});

// Also update .gitignore
```

**Updated .gitignore:**

```gitignore
# Playwright artifacts
playwright-report-data/
playwright-report-data/**
```

---

### Layer 3: Discipline (Fixes the Behavior)

#### 3A. Documentation Health Checklist

**Before committing any .md file:**

```markdown
# Documentation Pre-Commit Checklist

□ **Purpose Clear**: Document describes specific, single purpose
  - If describing multiple issues, split into separate files
  - Title matches content

□ **Audience Identified**: Document targets specific audience
  - Developers? DevOps? Incident responders?
  - Adjust technical level accordingly

□ **Status Defined**: Document has explicit lifecycle status
  ```markdown
  **Status**: [DRAFT|ACTIVE|ARCHIVED]
  **Version**: X.Y
  **Last Updated**: YYYY-MM-DD
  ```

□ **Dated Properly**: All filenames include YYYY-MM-DD
  - No "latest", "current", "temp" suffixes
  - Pattern: `prefix-YYYY-MM-DD[-context].md`

□ **Linked from Index**: Document linked from parent README
  - reports/README.md
  - .claude/prevention/README.md
  - .claude/lessons/README.md
  - docs/SOLUTIONS.md

□ **Not Duplicate**: Verify document doesn't already exist
  ```bash
  git log --all -- "*$(basename $filename)" | head -5
  ```

□ **Retention Policy Set**: Document knows its shelf life
  ```markdown
  **Retention**: [Until resolved | Until YYYY-MM-DD | Indefinite]
  **Archive**: [docs/archive/YYYY-QN/ | .claude/lessons/ | reports/archive/]
  ```

□ **No Sensitive Data**: No credentials, API keys, PII
  - Search for: `password`, `secret`, `key`, `token`, email
  - If needed, use environment variable references only

□ **Links Work**: All internal links resolve
  ```bash
  python3 scripts/validate_links.py --file $filename
  ```
```

**Automation in pre-commit hook:**

```bash
# .husky/pre-commit (add to existing)

# Documentation health checks
for file in $(git diff --cached --name-only | grep '\.md$'); do
    # Check for required fields
    if ! head -n 20 "$file" | grep -qE "Status:|Last Updated:"; then
        if [[ "$file" == ".claude/prevention/"* ]] || [[ "$file" == ".claude/lessons/"* ]]; then
            echo "✗ $file missing Status and Last Updated in header"
            exit 1
        fi
    fi
done
```

#### 3B. Weekly Triage Protocol

**Friday afternoon discipline (15 minutes):**

```bash
#!/bin/bash
# scripts/weekly-doc-triage.sh

# Run weekly Friday triage
set -e

WEEK=$(date +%Y-W%V)
REPORT_FILE="reports/triage-$WEEK.md"

echo "=== Weekly Documentation Triage ===" | tee "$REPORT_FILE"
echo "" >> "$REPORT_FILE"
echo "**Date**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> "$REPORT_FILE"
echo "" >> "$REPORT_FILE"

# 1. Find orphaned reports (> 30 days, no recent access)
echo "## 1. Orphaned Reports" >> "$REPORT_FILE"

find reports -maxdepth 1 -type f -name "*.md" -mtime +30 ! -name "README.md" ! -name "ARCHIVE_MANIFEST.md" | while read file; do
    MTIME=$(stat -f "%SB" -t "%Y-%m-%d" "$file")
    BASENAME=$(basename "$file")
    echo "- [ ] $BASENAME (last modified: $MTIME) - ARCHIVE?" >> "$REPORT_FILE"
done

# 2. Find undated files
echo "" >> "$REPORT_FILE"
echo "## 2. Files Missing Dates" >> "$REPORT_FILE"

find reports .claude -maxdepth 2 -type f \( -name "*.md" -o -name "*.json" \) | grep -v "README.md" | grep -v "archive" | grep -v "cache" | while read file; do
    if ! echo "$file" | grep -qE '[0-9]{4}-[0-9]{2}-[0-9]{2}'; then
        echo "- [ ] $file - RENAME?" >> "$REPORT_FILE"
    fi
done

# 3. Find files needing archival
echo "" >> "$REPORT_FILE"
echo "## 3. Candidates for Archival" >> "$REPORT_FILE"

find reports -maxdepth 1 -type f -name "*.md" | while read file; do
    if head -n 5 "$file" | grep -qi "ARCHIVED\|DEPRECATED\|OBSOLETE"; then
        echo "- [ ] $(basename "$file") - MOVE TO ARCHIVE/" >> "$REPORT_FILE"
    fi
done

# 4. Statistics
echo "" >> "$REPORT_FILE"
echo "## Statistics" >> "$REPORT_FILE"
echo "- Reports directory size: $(du -sh reports | cut -f1)" >> "$REPORT_FILE"
echo "- .claude directory size: $(du -sh .claude | cut -f1)" >> "$REPORT_FILE"
echo "- Playwright report size: $(du -sh playwright-report 2>/dev/null | cut -f1 || echo 'N/A')" >> "$REPORT_FILE"

echo -e "\n=== Triage complete ==="
echo "Review: $REPORT_FILE"
```

**Run before Friday EOD:**

```bash
npm run triage:docs  # Add to package.json
```

#### 3C. Monthly Archive Review

**First Friday of month: 30-minute review**

```markdown
# Monthly Documentation Review Checklist

**Month**: December 2025
**Reviewer**: @team
**Date**: 2025-12-05

## Reviews

### Reports Archive Health
- [ ] Browse reports/archive/YYYY-MM/
- [ ] Delete obvious duplicates
- [ ] Verify all files are dated
- [ ] Update ARCHIVE_MANIFEST.md

### Lessons Learned Relevance
- [ ] Check .claude/lessons/ for currency
- [ ] Mark obsolete lessons with `[SUPERSEDED BY CL-*]`
- [ ] Ensure recent lessons documented

### Prevention Strategies Accuracy
- [ ] Review .claude/prevention/ against current code
- [ ] Check for patterns that no longer apply
- [ ] Document new prevention needs discovered

### TODO System State
- [ ] todos/.archive/ has > 100 items? → Annual cleanup
- [ ] Active todos/ reasonable number? (< 30)
- [ ] All TODOs dated and prioritized?

### Clean-Up Tasks
- [ ] Archive reports older than 60 days
- [ ] Remove e2e artifacts older than 7 days
- [ ] Delete coverage reports older than 30 days
- [ ] Consolidate duplicate documentation

## Actions Taken

- [ ] Action 1: ...
- [ ] Action 2: ...

## Sign-Off

- [ ] All actions completed
- [ ] Team notified of changes
- [ ] Next review: January 2026
```

---

## Implementation Roadmap

### Phase 1: Immediate (This Week)

```
1. Update .gitignore
   - Add hardened rules for playwright-report/data/
   - Add rules for undated report files
   - Commit and test

2. Install pre-commit hook
   - Deploy pre-commit-orphan-guard.sh
   - Test against various file patterns
   - Commit .git/hooks/pre-commit

3. Document lifecycle
   - Create MANIFEST.md for active reports
   - Add this prevention strategy to .claude/prevention/
   - Update reports/README.md with retention policy
```

### Phase 2: Automation (Next 2 Weeks)

```
4. Setup cleanup GitHub Actions
   - Deploy .github/workflows/orphan-cleanup.yml
   - Test on dev branch (don't merge yet)
   - Verify no data loss

5. Add npm scripts
   - npm run triage:docs
   - npm run validate:reports
   - npm run archive:reports
   - npm run manage:lifecycle

6. Document in CLAUDE.md
   - Add new npm scripts to commands section
   - Add weekly/monthly discipline procedures
```

### Phase 3: Discipline (Ongoing)

```
7. Team adoption
   - Share checklist with team
   - Add to PR review template
   - Schedule Friday triage
   - Schedule monthly review

8. Monitor effectiveness
   - Track files archived per month
   - Measure reduction in orphan count
   - Survey team for friction points
```

---

## Prevention Checklist: Quick Reference

### Daily
- [ ] Before commit: Check document has date in filename
- [ ] Before commit: Verify link to parent README added
- [ ] Before committing generated files: Check .gitignore rules

### Weekly (Friday)
- [ ] Run `npm run triage:docs`
- [ ] Review triage report for archival candidates
- [ ] Archive old reports (> 30 days)
- [ ] Clean e2e artifacts (> 7 days)

### Monthly (1st Friday)
- [ ] Review archive health
- [ ] Update MANIFEST.md
- [ ] Check for duplicate documentation
- [ ] Verify retention policies followed

### Quarterly
- [ ] Review this prevention strategy document
- [ ] Update team on lessons learned
- [ ] Audit .claude/prevention/ for accuracy
- [ ] Plan next automation improvements

---

## Metrics to Track

### Effectiveness Measures

```javascript
// Track in GitHub Actions logs and npm scripts

metrics = {
  "reports_root_count": 5,           // Target: < 10
  "orphan_commit_blocks": 0,         // Target: 0 (prevention working)
  "avg_report_age": "14 days",       // Target: < 30 days
  "archival_rate_per_month": "45%",  // Target: 40-50%
  "broken_links": 3,                 // Target: 0
  "undated_files": 0,                // Target: 0
  "duplicate_documents": 0,          // Target: 0
}
```

### Success Criteria (After 3 Months)

- [ ] Zero orphan files in staged commits (pre-commit enforcement)
- [ ] All reports in reports/ dated (YYYY-MM-DD naming)
- [ ] reports/ directory contains < 10 files at root
- [ ] No generated files accidentally committed
- [ ] Archive contains all reports > 60 days old
- [ ] Team performs weekly triage without friction

---

## Troubleshooting Guide

### Problem: .gitignore Rule Not Working

```bash
# Clear git cache
git rm -r --cached reports/e2e/
git add reports/.gitignore
git commit -m "fix: remove orphaned e2e artifacts from git history"
git push
```

### Problem: Pre-commit Hook Rejecting Valid Files

```bash
# Test specific file against rules
git check-ignore -v path/to/file

# Update rules if false positive
# Then test again
```

### Problem: Too Many Files in Archive

```bash
# List largest files
find reports/archive -type f -exec ls -lh {} \; | sort -k5 -hr | head -20

# Compress old reports
gzip reports/archive/2025-Q1/*.json
```

### Problem: Developers Committing Despite Hook

```bash
# Verify hook is executable
ls -la .git/hooks/pre-commit

# Reinstall if broken
cp scripts/pre-commit-orphan-guard.sh .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit

# Test
echo "test" > reports/test.md
git add reports/test.md
git commit -m "test" # Should fail
```

---

## Related Documentation

- **Parent**: [.claude/prevention/README.md](./)
- **Implementation**: [scripts/manage-report-lifecycle.sh](/scripts/)
- **Configuration**: [.gitignore](/.gitignore)
- **Guidelines**: [CLAUDE.md](/CLAUDE.md) - Testing and Deployment
- **Lessons**: [CL-MAINT-001: Worktree System Hygiene](./../lessons/CL-MAINT-001-worktree-system-hygiene.md)

---

## Summary: Prevention Over Cleanup

### What Changed

| Before | After |
|--------|-------|
| Generated files mixed with tracked | Hardened .gitignore blocks them |
| Old reports accumulate silently | Automated weekly cleanup |
| Warnings but no blocks | Pre-commit hook enforces rules |
| Manual archival needed | Automated lifecycle management |
| No naming convention | Enforced YYYY-MM-DD format |
| Unknown retention policy | Clear 30/60/365-day rules |

### Key Principles

1. **Prevent at Commit Time** - Don't let orphans enter repo
2. **Automate Cleanup** - Machines handle tedious work
3. **Enforce Naming** - Date every file, purpose every document
4. **Index Everything** - README links make discoverability easy
5. **Archive Intentionally** - Old ≠ Delete, move to archive
6. **Review Regularly** - Weekly triage catches problems early

---

**Prevention Strategy Owner**: DevOps Team
**Review Frequency**: Quarterly (Next: 2025-03-24)
**Last Verified**: 2025-12-24
**Status**: ACTIVE
