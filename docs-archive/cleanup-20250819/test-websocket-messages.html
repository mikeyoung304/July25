<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Message Test</title>
</head>
<body>
    <h1>WebSocket Message Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <button onclick="sendTestMessage()">Send Test Message</button>
    
    <script>
        const restaurantId = '11111111-1111-1111-1111-111111111111';
        const token = 'test-token';
        const wsUrl = `ws://localhost:3001?token=${token}&restaurant_id=${restaurantId}`;
        
        const ws = new WebSocket(wsUrl);
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        
        function log(message, data = null) {
            const entry = document.createElement('div');
            entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            if (data) {
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                entry.appendChild(pre);
            }
            messagesDiv.appendChild(entry);
            console.log(message, data);
        }
        
        ws.onopen = () => {
            statusDiv.textContent = 'Connected!';
            log('WebSocket connected');
            
            // Request order sync
            ws.send(JSON.stringify({
                type: 'orders:sync',
                payload: { requestFullSync: true }
            }));
        };
        
        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            log(`Received message type: ${message.type}`, message);
            
            // Check the structure
            if (message.type === 'order:created') {
                log('ORDER CREATED EVENT STRUCTURE:', {
                    hasPayload: !!message.payload,
                    hasOrder: !!(message.payload && message.payload.order),
                    orderKeys: message.payload && message.payload.order ? Object.keys(message.payload.order) : []
                });
            }
        };
        
        ws.onerror = (error) => {
            statusDiv.textContent = 'Error!';
            log('WebSocket error:', error);
        };
        
        ws.onclose = () => {
            statusDiv.textContent = 'Disconnected';
            log('WebSocket closed');
        };
        
        function sendTestMessage() {
            ws.send(JSON.stringify({
                type: 'ping',
                timestamp: new Date().toISOString()
            }));
        }
    </script>
</body>
</html>