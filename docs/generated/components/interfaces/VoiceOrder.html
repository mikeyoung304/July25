<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>grow-fresh-local-food documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">grow-fresh-local-food documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  VoiceOrder</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>client/src/modules/voice/services/orderIntegration.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#items" 
>
                                            items
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#orderType" 
>
                                            orderType
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#specialRequests" 
>
                                            specialRequests
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="items"></a>
                                        <span class="name "><b>items</b>
                                            <a href="#items">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>items:         <code><a href="../interfaces/ParsedVoiceItem.html" target="_self" >ParsedVoiceItem[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/ParsedVoiceItem.html" target="_self" >ParsedVoiceItem[]</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="orderType"></a>
                                        <span class="name "><b>orderType</b>
                                            <a href="#orderType">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>orderType:     <code>&quot;dine-in&quot; | &quot;takeout&quot;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>&quot;dine-in&quot; | &quot;takeout&quot;</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="specialRequests"></a>
                                        <span class="name "><b>specialRequests</b>
                                            <a href="#specialRequests">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>specialRequests:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { api } from &#x27;@/services/api&#x27;
import { Order, OrderType } from &#x27;@rebuild/shared&#x27;

export interface ParsedVoiceItem {
  id?: string
  name: string
  quantity: number
  modifiers?: string[]
}

export interface VoiceOrder {
  items: ParsedVoiceItem[]
  specialRequests?: string
  orderType?: &#x27;dine-in&#x27; | &#x27;takeout&#x27;
}

/**
 * Converts voice transcription to structured order data
 * In production, this would use NLP/AI for better parsing
 */
export const parseVoiceOrder &#x3D; (transcription: string): VoiceOrder | null &#x3D;&gt; {
  const lowerText &#x3D; transcription.toLowerCase()
  const items: ParsedVoiceItem[] &#x3D; []
  
  // Grow Fresh Local Food menu patterns with Southern accent variations
  const menuItems &#x3D; [
    // Bowls
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:soul|sole|georgia\s*soul|soul\s*food)\s*(?:bowl|bol)s?/gi, name: &#x27;Soul Bowl&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:chicken\s*)?(?:fajita|fahita|faheta)\s*(?:keto|keeto|ketto)?(?:\s*bowl)?s?/gi, name: &#x27;Chicken Fajita Keto&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:greek|mediterran(?:ean)?)\s*(?:bowl|chicken|bol)s?/gi, name: &#x27;Greek Bowl&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:summer\s*)?vegan\s*(?:bowl|bol)s?/gi, name: &#x27;Summer Vegan Bowl&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:summer\s*)?succotash(?:\s*bowl)?s?/gi, name: &#x27;Summer Succotash&#x27; },
    
    // Salads
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:summer|house|seasonal)\s*salads?/gi, name: &#x27;Summer Salad&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?peach\s*(?:arugula|salad)s?/gi, name: &#x27;Peach Arugula Salad&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?greek\s*salads?/gi, name: &#x27;Greek Salad&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?tuna\s*(?:salad|plate)s?/gi, name: &#x27;Tuna Salad&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:mom&#x27;?s?|mama&#x27;?s?)\s*chicken\s*salads?/gi, name: &quot;Mom&#x27;s Chicken Salad&quot; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?grilled\s*chicken\s*salads?/gi, name: &#x27;Grilled Chicken Salad&#x27; },
    
    // Starters
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:summer\s*)?samplers?/gi, name: &#x27;Summer Sampler&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?peach\s*(?:and\s*)?(?:prosciutto\s*)?capreses?/gi, name: &#x27;Peach &amp; Prosciutto Caprese&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?watermelon\s*tatakis?/gi, name: &#x27;Watermelon Tataki&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?tea\s*sandwich(?:es)?/gi, name: &#x27;Tea Sandwiches&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:jalape[nñ]o\s*)?pimento\s*(?:cheese\s*)?bites?/gi, name: &#x27;Jalapeño Pimento Bites&#x27; },
    
    // Entrees
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?peach\s*chickens?/gi, name: &#x27;Peach Chicken&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:teriyaki\s*)?salmon(?:\s*over\s*rice)?s?/gi, name: &#x27;Teriyaki Salmon Over Rice&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?hamburger\s*steaks?(?:\s*over\s*rice)?/gi, name: &#x27;Hamburger Steak over rice&#x27; },
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?greek\s*chicken\s*thighs?(?:\s*over\s*rice)?/gi, name: &#x27;Greek Chicken Thighs (2) Over Rice&#x27; },
    
    // Veggie Plate
    { pattern: /(\d+|one|two|three|four|five)?\s*(?:x\s*)?(?:veggie|vegetable|vegetarian)\s*plates?/gi, name: &#x27;Veggie Plate&#x27; },
  ]
  
  // Extract items with quantities
  menuItems.forEach(({ pattern, name }) &#x3D;&gt; {
    const matches &#x3D; Array.from(transcription.matchAll(pattern))
    matches.forEach(match &#x3D;&gt; {
      let quantity &#x3D; 1
      if (match[1]) {
        // Handle numeric quantities
        const num &#x3D; parseInt(match[1])
        if (!isNaN(num)) {
          quantity &#x3D; num
        } else {
          // Handle word quantities
          const wordToNum: Record&lt;string, number&gt; &#x3D; {
            &#x27;one&#x27;: 1, &#x27;two&#x27;: 2, &#x27;three&#x27;: 3, &#x27;four&#x27;: 4, &#x27;five&#x27;: 5
          }
          quantity &#x3D; wordToNum[match[1].toLowerCase()] || 1
        }
      }
      const modifiers &#x3D; extractModifiers(transcription, name.toLowerCase())
      items.push({ name, quantity, modifiers })
    })
  })
  
  if (items.length &#x3D;&#x3D;&#x3D; 0) return null
  
  // Extract special requests
  const specialRequests &#x3D; extractSpecialRequests(transcription)
  
  // Determine order type
  const orderType &#x3D; lowerText.includes(&#x27;take&#x27;) || lowerText.includes(&#x27;to go&#x27;) 
    ? &#x27;takeout&#x27; 
    : &#x27;dine-in&#x27;
  
  return {
    items,
    specialRequests,
    orderType
  }
}

const extractModifiers &#x3D; (text: string, itemName: string): string[] &#x3D;&gt; {
  const modifiers: string[] &#x3D; []
  const lowerText &#x3D; text.toLowerCase()
  const lowerItem &#x3D; itemName.toLowerCase()
  
  // Common modifiers for Grow Fresh Local Food
  // Bowl modifiers
  if (lowerItem.includes(&#x27;bowl&#x27;)) {
    if (lowerText.includes(&#x27;no rice&#x27;) || lowerText.includes(&#x27;without rice&#x27;)) modifiers.push(&#x27;No rice&#x27;)
    if (lowerText.includes(&#x27;extra collards&#x27;) || lowerText.includes(&#x27;more collards&#x27;)) modifiers.push(&#x27;Extra collards&#x27;)
    if (lowerText.includes(&#x27;no olives&#x27;) || lowerText.includes(&#x27;without olives&#x27;)) modifiers.push(&#x27;No olives&#x27;)
    if (lowerText.includes(&#x27;no feta&#x27;) || lowerText.includes(&#x27;without feta&#x27;)) modifiers.push(&#x27;No feta&#x27;)
    if (lowerText.includes(&#x27;extra sauce&#x27;) || lowerText.includes(&#x27;more sauce&#x27;)) modifiers.push(&#x27;Extra sauce&#x27;)
  }
  
  // Chicken Fajita Keto specific
  if (lowerItem.includes(&#x27;keto&#x27;)) {
    if (lowerText.includes(&#x27;add rice&#x27;) || lowerText.includes(&#x27;with rice&#x27;)) modifiers.push(&#x27;Add rice&#x27;)
  }
  
  // Salad modifiers
  if (lowerItem.includes(&#x27;salad&#x27;)) {
    if (lowerText.includes(&#x27;add chicken&#x27;) || lowerText.includes(&#x27;with chicken&#x27;)) modifiers.push(&#x27;Add chicken&#x27;)
    if (lowerText.includes(&#x27;add salmon&#x27;) || lowerText.includes(&#x27;with salmon&#x27;)) modifiers.push(&#x27;Add salmon&#x27;)
    if (lowerText.includes(&#x27;add prosciutto&#x27;) || lowerText.includes(&#x27;with prosciutto&#x27;)) modifiers.push(&#x27;Add prosciutto&#x27;)
    if (lowerText.includes(&#x27;no dressing&#x27;) || lowerText.includes(&#x27;without dressing&#x27;)) modifiers.push(&#x27;No dressing&#x27;)
  }
  
  // Veggie plate modifiers
  if (lowerItem.includes(&#x27;veggie plate&#x27;)) {
    if (lowerText.includes(&#x27;three sides&#x27;) || lowerText.includes(&#x27;3 sides&#x27;)) modifiers.push(&#x27;Three sides&#x27;)
    if (lowerText.includes(&#x27;four sides&#x27;) || lowerText.includes(&#x27;4 sides&#x27;)) modifiers.push(&#x27;Four sides&#x27;)
  }
  
  // Dietary preferences
  if (lowerText.includes(&#x27;make it vegan&#x27;) || lowerText.includes(&#x27;vegan version&#x27;)) modifiers.push(&#x27;Make it vegan&#x27;)
  if (lowerText.includes(&#x27;gluten free&#x27;) || lowerText.includes(&#x27;no gluten&#x27;)) modifiers.push(&#x27;Gluten free&#x27;)
  
  // Side selection
  const sidePattern &#x3D; /with\s+(collards?|rice|sweet\s*potatoes?|black\s*eye(?:d)?\s*peas|potato\s*salad|fruit|cucumber\s*salad|noodles)/gi
  let sideMatch
  while ((sideMatch &#x3D; sidePattern.exec(lowerText)) !&#x3D;&#x3D; null) {
    modifiers.push(&#x60;With ${sideMatch[1]}&#x60;)
  }
  
  return modifiers
}

const extractSpecialRequests &#x3D; (text: string): string | undefined &#x3D;&gt; {
  // Look for special request indicators
  const patterns &#x3D; [
    /please\s+(.+?)(?:\.|$)/i,
    /make\s+sure\s+(.+?)(?:\.|$)/i,
    /allergic\s+to\s+(.+?)(?:\.|$)/i,
  ]
  
  for (const pattern of patterns) {
    const match &#x3D; text.match(pattern)
    if (match) {
      return match[1].trim()
    }
  }
  
  return undefined
}

/**
 * Submits a voice order to the KDS system
 */
export const submitVoiceOrder &#x3D; async (voiceOrder: VoiceOrder) &#x3D;&gt; {
  // Convert to API format
  const orderData: Partial&lt;Order&gt; &#x3D; {
    table_number: &#x27;K1&#x27;, // K for Kiosk
    items: voiceOrder.items.map(item &#x3D;&gt; ({
      id: &#x60;${Date.now()}-${Math.random()}&#x60;,
      menu_item_id: item.id || &#x60;menu-${Date.now()}&#x60;,
      name: item.name,
      quantity: item.quantity,
      price: calculateItemPrice(item.name),
      subtotal: calculateItemPrice(item.name) * item.quantity,
      modifiers: item.modifiers?.map(mod &#x3D;&gt; ({
        id: &#x60;mod-${Date.now()}-${Math.random()}&#x60;,
        name: mod,
        price: 0
      })),
      special_instructions: voiceOrder.specialRequests
    })),
    total: calculateTotal(voiceOrder.items),
    type: (voiceOrder.type || &#x27;voice&#x27;) as OrderType
  }
  
  return api.submitOrder(orderData)
}

const calculateItemPrice &#x3D; (itemName: string): number &#x3D;&gt; {
  const prices: Record&lt;string, number&gt; &#x3D; {
    // Starters
    &#x27;Summer Sampler&#x27;: 16,
    &#x27;Peach &amp; Prosciutto Caprese&#x27;: 12,
    &#x27;Watermelon Tataki&#x27;: 12,
    &#x27;Tea Sandwiches&#x27;: 10,
    &#x27;Jalapeño Pimento Bites&#x27;: 10,
    
    // Salads
    &#x27;Summer Salad&#x27;: 12,
    &#x27;Peach Arugula Salad&#x27;: 12,
    &#x27;Greek Salad&#x27;: 12,
    &#x27;Tuna Salad&#x27;: 14,
    &quot;Mom&#x27;s Chicken Salad&quot;: 13,
    &#x27;Grilled Chicken Salad&#x27;: 14,
    
    // Bowls
    &#x27;Soul Bowl&#x27;: 14,
    &#x27;Chicken Fajita Keto&#x27;: 14,
    &#x27;Greek Bowl&#x27;: 14,
    &#x27;Summer Vegan Bowl&#x27;: 14,
    &#x27;Summer Succotash&#x27;: 14
  }
  
  return prices[itemName] || 10 // Default price if not found
}

const calculateTotal &#x3D; (items: ParsedVoiceItem[]): number &#x3D;&gt; {
  return items.reduce((total, item) &#x3D;&gt; {
    const basePrice &#x3D; calculateItemPrice(item.name)
    return total + (basePrice * item.quantity)
  }, 0)
}</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'VoiceOrder.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
