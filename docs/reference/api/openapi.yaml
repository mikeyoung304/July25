openapi: 3.0.3
info:
  title: Restaurant OS API
  version: 6.0.14
  x-last-updated: '2025-11-18'
  description: |
    Restaurant OS provides a comprehensive API for managing restaurant operations including:
    - Point of Sale (POS)
    - Kitchen Display System (KDS)
    - Online ordering and checkout
    - Voice ordering via WebRTC (OpenAI Realtime API)
    - Payment processing (Square integration)
    - Table management
    - Menu management

    ## Authentication

    The API supports dual authentication:
    - **Production**: Supabase JWT (RLS-enforced)
    - **Development**: JWT fallback (demo/PIN/station authentication)

    All authenticated endpoints require an `Authorization: Bearer <token>` header.
    Multi-tenant requests also require `X-Restaurant-ID` header.

    See [Authentication Architecture](../../explanation/architecture/AUTHENTICATION_ARCHITECTURE.md) for details.
  contact:
    name: Restaurant OS Team
    url: https://github.com/mikeyoung304/rebuild-6.0
  license:
    name: Proprietary
servers:
  - url: http://localhost:3001/api/v1
    description: Local development server
  - url: https://production-url/api/v1
    description: Production server
security:
  - BearerAuth: []
tags:
  - name: Authentication
    description: User authentication and session management
  - name: Orders
    description: Order creation and management
  - name: Menu
    description: Menu items and categories
  - name: Payments
    description: Payment processing via Square
  - name: Voice & AI
    description: Voice ordering and AI services via WebRTC
  - name: Tables
    description: Table management for dine-in service
  - name: Health
    description: Health checks and monitoring
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Supabase JWT (production) or custom JWT (demo/PIN/station).
        Include in header: `Authorization: Bearer <token>`
  parameters:
    RestaurantIdHeader:
      name: X-Restaurant-ID
      in: header
      required: true
      description: Restaurant ID for multi-tenant context
      schema:
        type: string
        format: uuid
        example: 11111111-1111-1111-1111-111111111111
    ClientFlowHeader:
      name: X-Client-Flow
      in: header
      required: false
      description: Client flow for telemetry and flow-specific logic
      schema:
        type: string
        enum:
          - online
          - kiosk
          - server
        example: online
  schemas:
    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: Invalid request
        message:
          type: string
          description: Detailed error message
          example: Order ID is required
        code:
          type: string
          description: Error code
          example: VALIDATION_ERROR
        detail:
          type: string
          description: Additional error details
    User:
      type: object
      required:
        - id
        - role
      properties:
        id:
          type: string
          format: uuid
          description: User ID
        email:
          type: string
          format: email
          description: User email (if applicable)
        displayName:
          type: string
          description: User display name
        role:
          type: string
          enum:
            - customer
            - server
            - kitchen
            - expo
            - cashier
            - manager
            - owner
          description: User role in restaurant
        scopes:
          type: array
          items:
            type: string
          description: User permissions/scopes
          example:
            - orders:create
            - orders:read
            - payments:process
    AuthSession:
      type: object
      required:
        - access_token
      properties:
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: Refresh token (Supabase auth only)
        expires_in:
          type: integer
          description: Token expiration time in seconds
          example: 3600
    MenuItem:
      type: object
      required:
        - id
        - name
        - price
        - restaurant_id
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: Soul Bowl
        description:
          type: string
          example: Fresh greens with grilled chicken and house dressing
        price:
          type: number
          format: float
          example: 12.99
        category:
          type: string
          example: Bowls
        available:
          type: boolean
          default: true
        restaurant_id:
          type: string
          format: uuid
        image_url:
          type: string
          format: uri
          description: Menu item image URL
    OrderItem:
      type: object
      required:
        - menu_item_id
        - quantity
        - price
      properties:
        id:
          type: string
          format: uuid
          description: Order item ID (generated server-side)
        menu_item_id:
          type: string
          format: uuid
          description: Reference to menu_items table
        name:
          type: string
          example: Soul Bowl
        quantity:
          type: integer
          minimum: 1
          example: 2
        price:
          type: number
          format: float
          description: Item price at time of order
          example: 12.99
        subtotal:
          type: number
          format: float
          description: Calculated subtotal (price * quantity)
          example: 25.98
        modifiers:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              price:
                type: number
          description: Item modifiers (e.g., "Extra Cheese")
        special_instructions:
          type: string
          example: No onions
    Order:
      type: object
      required:
        - id
        - restaurant_id
        - order_number
        - status
        - type
        - items
        - subtotal
        - tax
        - total
        - payment_status
      properties:
        id:
          type: string
          format: uuid
        restaurant_id:
          type: string
          format: uuid
        order_number:
          type: string
          example: ORD-1001
        customer_name:
          type: string
          example: John Doe
        customer_phone:
          type: string
          example: +1-555-123-4567
        customer_email:
          type: string
          format: email
        type:
          type: string
          enum:
            - online
            - pickup
            - delivery
          description: Database-valid order type
        status:
          type: string
          enum:
            - new
            - pending
            - confirmed
            - preparing
            - ready
            - picked-up
            - completed
            - cancelled
          description: Order lifecycle status
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        subtotal:
          type: number
          format: float
          description: Sum of all item subtotals
        tax:
          type: number
          format: float
          description: Tax amount
        tip:
          type: number
          format: float
          description: Tip amount (optional)
        total:
          type: number
          format: float
          description: Grand total (subtotal + tax + tip)
        payment_status:
          type: string
          enum:
            - unpaid
            - paid
            - failed
            - refunded
          description: Payment lifecycle status (matches database CHECK constraint)
        payment_method:
          type: string
          enum:
            - cash
            - card
            - house_account
            - gift_card
            - other
          description: Payment method (matches database CHECK constraint)
        table_number:
          type: string
          example: T5
        seat_number:
          type: integer
          description: Seat number for multi-seat ordering
        notes:
          type: string
          example: Extra napkins please
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        estimated_ready_time:
          type: string
          format: date-time
        scheduled_pickup_time:
          type: string
          format: date-time
          description: For scheduled orders
        is_scheduled:
          type: boolean
          description: Whether order is scheduled for future
    CreateOrderRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          items:
            type: object
            required:
              - menu_item_id
              - quantity
              - price
            properties:
              menu_item_id:
                type: string
                format: uuid
              quantity:
                type: integer
                minimum: 1
              price:
                type: number
              modifiers:
                type: array
                items:
                  type: object
              special_instructions:
                type: string
        customer_name:
          type: string
        customer_phone:
          type: string
        customer_email:
          type: string
          format: email
        type:
          type: string
          enum:
            - online
            - pickup
            - delivery
          default: online
        table_number:
          type: string
        seat_number:
          type: integer
        notes:
          type: string
        payment_method:
          type: string
          enum:
            - cash
            - card
            - house_account
            - gift_card
            - other
          description: Payment method (matches database CHECK constraint)
        scheduled_pickup_time:
          type: string
          format: date-time
    PaymentRequest:
      type: object
      required:
        - order_id
        - token
      properties:
        order_id:
          type: string
          format: uuid
          description: Order ID to process payment for
        token:
          type: string
          description: Square payment token (from Square Web Payments SDK)
        amount:
          type: number
          format: float
          description: |
            Payment amount (OPTIONAL - server validates and recalculates).
            Server NEVER trusts client-provided amounts.
        idempotency_key:
          type: string
          description: |
            Unique key to prevent duplicate charges (OPTIONAL - server generates if not provided).
            Format: UUID v4
        verification_token:
          type: string
          description: 3D Secure verification token (if applicable)
    CashPaymentRequest:
      type: object
      required:
        - order_id
        - amount_received
      properties:
        order_id:
          type: string
          format: uuid
        amount_received:
          type: number
          format: float
          description: Amount of cash received from customer
          example: 20
        table_id:
          type: string
          format: uuid
          description: Table ID (if dine-in payment)
    Table:
      type: object
      required:
        - id
        - restaurant_id
        - label
        - status
      properties:
        id:
          type: string
          format: uuid
        restaurant_id:
          type: string
          format: uuid
        label:
          type: string
          example: T5
        capacity:
          type: integer
          minimum: 1
          example: 4
        status:
          type: string
          enum:
            - available
            - occupied
            - reserved
            - cleaning
        x:
          type: number
          description: X position for floor plan (frontend property)
        'y':
          type: number
          description: Y position for floor plan (frontend property)
        type:
          type: string
          enum:
            - rectangle
            - circle
            - square
          description: Table shape (frontend property, maps to 'shape' in DB)
        z_index:
          type: integer
          description: Z-index for layering
        section:
          type: string
          example: Patio
        current_order_id:
          type: string
          format: uuid
          description: Current order associated with table
        active:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
  responses:
    UnauthorizedError:
      description: Authentication required or failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Invalid email or password
            code: UNAUTHORIZED
paths:
  /api/v1/ai/menu:
    post:
      tags:
        - Ai
      summary: Create menu
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    get:
      tags:
        - Ai
      summary: Get menu
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/transcribe:
    post:
      tags:
        - Voice & AI
      summary: Transcribe audio to text
      description: |
        Process audio file through OpenAI Whisper for transcription.
        Returns MP3 audio response for direct playback.
        Used by voice ordering system.

        **Authentication:** Not required (supports anonymous)
        **Rate Limit:** 100 requests/minute
      operationId: transcribeAudio
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - audio
              properties:
                audio:
                  type: string
                  format: binary
                  description: Audio file (WAV, MP3, M4A, WebM)
      responses:
        '200':
          description: Audio processed successfully
          content:
            audio/mpeg:
              schema:
                type: string
                format: binary
                description: MP3 audio response
        '400':
          description: Bad request (missing audio file)
        '503':
          description: AI provider unavailable
          headers:
            x-ai-degraded:
              schema:
                type: string
                enum: ['true']
  /api/v1/ai/transcribe-with-metadata:
    post:
      tags:
        - Ai
      summary: Create transcribe-with-metadata
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/parse-order:
    post:
      tags:
        - Voice & AI
      summary: Parse order from text
      description: |
        Use AI to parse natural language order text into structured menu items.
        Matches against restaurant menu, validates items, and returns parsed order.

        **Authentication:** Required
        **Scope:** `orders:create`
      operationId: parseOrder
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                  description: Natural language order text
                  example: "I want two Greek Bowls with extra tzatziki and a Soul Bowl"
            example:
              text: "I want two Greek Bowls with extra tzatziki and a Soul Bowl"
      responses:
        '200':
          description: Order parsed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        menu_item_id:
                          type: string
                          format: uuid
                        name:
                          type: string
                        quantity:
                          type: integer
                        price:
                          type: number
                        modifications:
                          type: array
                          items:
                            type: string
                  confidence:
                    type: number
                    format: float
        '400':
          description: Bad request
        '401':
          description: Unauthorized
  /api/v1/ai/voice-chat:
    post:
      tags:
        - Ai
      summary: Create voice-chat
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/chat:
    post:
      tags:
        - Ai
      summary: Create chat
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/health:
    get:
      tags:
        - Ai
      summary: Get health
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/test-tts:
    post:
      tags:
        - Ai
      summary: Create test-tts
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ai/test-transcribe:
    post:
      tags:
        - Ai
      summary: Create test-transcribe
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/login:
    post:
      tags:
        - Auth
      summary: Create login
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/pin-login:
    post:
      tags:
        - Auth
      summary: Create pin-login
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/station-login:
    post:
      tags:
        - Auth
      summary: Create station-login
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/logout:
    post:
      tags:
        - Auth
      summary: Create logout
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user profile
      description: |
        Retrieve the authenticated user's profile information including
        role, scopes, and restaurant access.

        **Authentication:** Required
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      email:
                        type: string
                        format: email
                      role:
                        type: string
                        enum: [admin, manager, staff, customer]
                      scopes:
                        type: array
                        items:
                          type: string
                        example: ["orders:create", "orders:read", "payments:process"]
                      display_name:
                        type: string
                  restaurant:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      name:
                        type: string
                      slug:
                        type: string
        '401':
          description: Unauthorized (missing or invalid token)
  /api/v1/auth/refresh:
    post:
      tags:
        - Auth
      summary: Create refresh
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/set-pin:
    post:
      tags:
        - Auth
      summary: Create set-pin
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/auth/revoke-stations:
    post:
      tags:
        - Auth
      summary: Create revoke-stations
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/menu/:
    get:
      tags:
        - Menu
      summary: Get menu
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/orders/:
    get:
      tags:
        - Orders
      summary: Get orders
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    post:
      tags:
        - Orders
      summary: Create order
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/tables/:
    get:
      tags:
        - Tables
      summary: Get tables
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    post:
      tags:
        - Tables
      summary: Create table
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/ready:
    get:
      tags:
        - Health
      summary: Kubernetes readiness probe
      description: |
        Readiness probe for Kubernetes. Checks if the application is ready
        to receive traffic (database connected, dependencies healthy).

        **Authentication:** Not required
      operationId: healthReadiness
      responses:
        '200':
          description: Application is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ready]
                  timestamp:
                    type: string
                    format: date-time
                  checks:
                    type: object
                    properties:
                      database:
                        type: string
                        enum: [ok, degraded]
                      ai_service:
                        type: string
                        enum: [ok, degraded]
        '503':
          description: Application not ready
  /api/v1/live:
    get:
      tags:
        - Health
      summary: Kubernetes liveness probe
      description: |
        Liveness probe for Kubernetes. Checks if the application process is alive.
        If this fails, Kubernetes will restart the container.

        **Authentication:** Not required
      operationId: healthLiveness
      responses:
        '200':
          description: Application is alive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [alive]
                  uptime:
                    type: number
                    description: Seconds since startup
  /api/v1/health:
    get:
      tags:
        - Health
      summary: General health check
      description: |
        General application health check endpoint.

        **Authentication:** Not required
      operationId: healthCheck
      responses:
        '200':
          description: Application is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ok]
                  timestamp:
                    type: string
                    format: date-time
  /api/v1/healthz:
    get:
      tags:
        - Health
      summary: Kubernetes health check
      description: |
        Kubernetes-compatible health check endpoint.

        **Authentication:** Not required
      operationId: healthz
      responses:
        '200':
          description: Application is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ok]
  /api/v1/realtime/health:
    get:
      tags:
        - Realtime
      summary: Realtime service health check
      description: |
        Health check for WebSocket/Realtime service.

        **Authentication:** Not required
      operationId: realtimeHealth
      responses:
        '200':
          description: Realtime service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ok]
                  connections:
                    type: number
                    description: Active WebSocket connections
  /api/v1/menu/items:
    get:
      tags:
        - Menu
      summary: Get items
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/menu/items/{id}:
    get:
      tags:
        - Menu
      summary: Get items
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/menu/categories:
    get:
      tags:
        - Menu
      summary: Get categories
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/menu/sync-ai:
    post:
      tags:
        - Menu
      summary: Create sync-ai
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/menu/cache/clear:
    post:
      tags:
        - Menu
      summary: Create clear
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/orders/voice:
    post:
      tags:
        - Orders
        - Voice & AI
      summary: Create order via voice
      description: |
        Process voice-based order creation using OpenAI Realtime API.
        Accepts audio transcription, parses items using AI, validates against menu,
        and creates an order. Returns confidence score and formatted response.

        **Authentication:** Required
        **Scope:** `orders:create`
        **Rate Limit:** 10 requests/minute
      operationId: createVoiceOrder
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - transcription
              properties:
                transcription:
                  type: string
                  description: Voice transcription text from client
                  example: "I'd like a Soul Bowl with extra tzatziki"
                audioUrl:
                  type: string
                  format: uri
                  description: Optional URL to audio file for audit/playback
                metadata:
                  type: object
                  description: Optional metadata (session ID, client info)
      responses:
        '200':
          description: Order processed (success or failure)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  order:
                    $ref: '#/components/schemas/Order'
                  confidence:
                    type: number
                    format: float
                    description: AI confidence score (0.0-1.0)
                  message:
                    type: string
                    description: User-friendly response message
                  suggestions:
                    type: array
                    items:
                      type: string
                    description: Suggested alternatives if parsing failed
              example:
                success: true
                order:
                  id: "uuid"
                  order_number: "ORD-1234"
                  items: [...]
                confidence: 0.85
                message: "Perfect! Your Soul Bowl will be ready in about 12 minutes."
        '400':
          description: Bad request (missing transcription)
        '401':
          description: Unauthorized (missing/invalid token)
        '403':
          description: Forbidden (missing scope)
  /api/v1/orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    delete:
      tags:
        - Orders
      summary: Delete order
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/orders/{id}/status:
    patch:
      tags:
        - Orders
      summary: Update order status
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/tables/{id}:
    get:
      tags:
        - Tables
      summary: Get table
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    put:
      tags:
        - Tables
      summary: Update table
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
    delete:
      tags:
        - Tables
      summary: Delete table
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/tables/{id}/status:
    patch:
      tags:
        - Tables
      summary: Update table status
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/restaurants/{id}:
    get:
      tags:
        - Restaurants
      summary: Get restaurant
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/payments/create:
    post:
      tags:
        - Payments
      summary: Process card payment
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/payments/cash:
    post:
      tags:
        - Payments
      summary: Process cash payment
      description: |
        Record a cash payment for an order. Tracks amount received, change given,
        and closes the check. Does not integrate with Square (cash-only).

        **Authentication:** Required
        **Scope:** `payments:process`
      operationId: createCashPayment
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - order_id
                - cash_received
              properties:
                order_id:
                  type: string
                  format: uuid
                cash_received:
                  type: number
                  format: float
                  description: Amount of cash received from customer (in dollars)
                  example: 20.00
            example:
              order_id: "uuid"
              cash_received: 20.00
      responses:
        '201':
          description: Cash payment processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  order:
                    $ref: '#/components/schemas/Order'
                  payment:
                    type: object
                    properties:
                      payment_amount:
                        type: number
                        description: Actual order total
                      cash_received:
                        type: number
                      change_given:
                        type: number
                        description: Change returned to customer
                      payment_status:
                        type: string
                        enum: [paid]
              example:
                success: true
                order: {...}
                payment:
                  payment_amount: 15.50
                  cash_received: 20.00
                  change_given: 4.50
                  payment_status: "paid"
        '400':
          description: Bad request (missing order_id or insufficient cash)
        '404':
          description: Order not found
  /api/v1/payments/{paymentId}:
    get:
      tags:
        - Payments
      summary: Get resource
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/payments/{paymentId}/refund:
    post:
      tags:
        - Payments
      summary: Create refund
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/realtime/session:
    post:
      tags:
        - Realtime
      summary: Create session
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/security/events:
    get:
      tags:
        - Security
      summary: Get events
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/security/stats:
    get:
      tags:
        - Security
      summary: Get stats
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/security/test:
    post:
      tags:
        - Security
      summary: Create test
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/security/config:
    get:
      tags:
        - Security
      summary: Get config
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/tables/batch:
    put:
      tags:
        - Tables
      summary: Batch update tables
      description: |
        Update multiple tables in a single optimized database operation.
        Used by Floor Plan Editor to save layout changes efficiently.
        Uses PostgreSQL RPC function for 40x performance improvement vs sequential updates.

        **Authentication:** Required
        **Scope:** `tables:write`
        **Performance:** ~2ms per table (vs 80ms sequential)
      operationId: batchUpdateTables
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/RestaurantIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tables
              properties:
                tables:
                  type: array
                  description: Array of table objects to update
                  items:
                    type: object
                    required:
                      - id
                    properties:
                      id:
                        type: string
                        format: uuid
                      label:
                        type: string
                      seats:
                        type: integer
                      x:
                        type: number
                        description: X position on canvas
                      y:
                        type: number
                        description: Y position on canvas
                      width:
                        type: number
                      height:
                        type: number
                      rotation:
                        type: integer
                        description: Rotation in degrees (0-360)
                      type:
                        type: string
                        enum: [circle, square, rectangle, chip_monkey]
                      status:
                        type: string
                        enum: [available, occupied, reserved, cleaning, unavailable]
                      z_index:
                        type: integer
                        description: Layer order for overlapping elements
            example:
              tables:
                - id: "uuid-1"
                  label: "T1"
                  seats: 4
                  x: 100
                  y: 200
                  width: 80
                  height: 80
                  rotation: 0
                  type: "circle"
                  status: "available"
                  z_index: 1
      responses:
        '200':
          description: Tables updated successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Table'
        '400':
          description: Bad request (invalid table data or duplicate names)
        '401':
          description: Unauthorized
  /api/v1/terminal/checkout:
    post:
      tags:
        - Terminal
      summary: Create checkout
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/terminal/checkout/{checkoutId}:
    get:
      tags:
        - Terminal
      summary: Get checkout
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/terminal/checkout/{checkoutId}/cancel:
    post:
      tags:
        - Terminal
      summary: Create cancel
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/terminal/checkout/{checkoutId}/complete:
    post:
      tags:
        - Terminal
      summary: Create complete
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/terminal/devices:
    get:
      tags:
        - Terminal
      summary: Get devices
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/webhooks/payments:
    post:
      tags:
        - Webhook
      summary: Payment webhook handler
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/webhooks/orders:
    post:
      tags:
        - Webhook
      summary: Order webhook handler
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
  /api/v1/webhooks/inventory:
    post:
      tags:
        - Webhook
      summary: Inventory webhook handler
      responses:
        '200':
          description: Successful response
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '500':
          description: Server error
      security:
        - bearerAuth: []
